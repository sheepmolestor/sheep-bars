/*! sheep-bars 09-03-2017 */
function createBars(){barAmount=randomInt(COLOURS.length-1)+1,colourBars.push({barJumpDisplacement:0,barPosition:1,barColour:Math.floor(Math.random()*COLOURS.length),barBooleans:booleanArray(barAmount,COLOURS.length),barCorrects:booleanArray(0,COLOURS.length),barFading:!1,barAlpha:1,age:0})}function colourPulse(){colourPulseSize=.04,barShift()}function colourBarTick(){colourPulseSize=decreaseIfPossible(colourPulseSize,.01,0),minimumFadeAge=BAR_FADE_MAXIMUM-(Math.min(score,BAR_FADE_END_SCORE)-BAR_FADE_SCORE)*(BAR_FADE_MAXIMUM-BAR_FADE_MINIMUM)/(BAR_FADE_END_SCORE-BAR_FADE_SCORE);for(var a=0;a<colourBars.length;a++)colourBars[a].barJumpDisplacement>0&&colourBars[a].barJumpDisplacement--,colourBars[a].barFading&&colourBars[a].barAlpha>0&&(colourBars[a].barAlpha-=1/BAR_FADE_FRAMES,colourBars[a].barAlpha<=0&&(colourBars[a].barAlpha=0)),score>BAR_FADE_SCORE&&colourBars[a].age>=minimumFadeAge&&(colourBars[a].barFading=!0),colourBars[a].age++}function removeAlpha(){for(var a=0;a<colourBars.length;a++)colourBars[a].barAlpha=1,colourBars[a].barFading=!1}function barShift(){correct=!0;for(var a=[],b=0;b<colourBars.length;b++){if(colourBars[b].barCorrects=booleanArray(0,COLOURS.length),8==colourBars[b].barPosition){for(var c=0;c<COLOURS.length;c++)colourBars[b].barBooleans[c]!=colourIndices[c]?(correct=!1,colourBars[b].barCorrects[c]=!1):colourBars[b].barBooleans[c]&&colourIndices[c]&&(colourBars[b].barCorrects[c]=!0);a.push(b),correction()}colourBars[b].barJumpDisplacement=5,colourBars[b].barPosition++}for(var d=0;d<a.length;d++)for(var e=0;e<COLOURS.length;e++)if(colourBars[a[d]].barCorrects[e])for(var f=0;f<30;f++)spawnParticle((Math.random()+e)*canvasWidth/COLOURS.length,BAR_Y*canvasHeight,COLOURS[e]);groupSplice(colourBars,a)}function drawBars(a){for(var b=0;b<colourBars.length;b++)for(var c=0;c<colourBars[b].barBooleans.length;c++)a.fillStyle=COLOURS[c],colourBars[b].barBooleans[c]&&(a.globalAlpha=colourBars[b].barAlpha,a.fillRect(c*(canvasWidth/COLOURS.length),((colourBars[b].barPosition-colourBars[b].barJumpDisplacement/5)*(BAR_Y/8)-.005-colourPulseSize/2)*canvasHeight,canvasWidth/COLOURS.length,(.01+colourPulseSize)*canvasHeight));a.globalAlpha=1}function initControlBar(){for(var a=0;a<COLOURS.length;a++)colourIndices.push(!1);document.onkeydown=function(a){e=a.keyCode,83==e?colourIndices[0]=!0:68==e?colourIndices[1]=!0:74==e?colourIndices[2]=!0:75==e&&(colourIndices[3]=!0)},document.onkeyup=function(a){e=a.keyCode,83==e?colourIndices[0]=!1:68==e?colourIndices[1]=!1:74==e?colourIndices[2]=!1:75==e&&(colourIndices[3]=!1)}}function drawControlBar(a){var b=["S","D","J","K"];a.fillStyle="white",a.fillRect(0,BAR_Y*canvasHeight,canvasWidth,(1-BAR_Y)*canvasHeight);for(var c=0;c<colourIndices.length;c++)a.fillStyle=COLOURS[c],colourIndices[c]&&a.fillRect(c*canvasWidth/COLOURS.length,BAR_Y*canvasHeight,canvasWidth/COLOURS.length,(1-BAR_Y)*canvasHeight),a.fillStyle="black",a.beginPath(),a.rect(c*canvasWidth/COLOURS.length,BAR_Y*canvasHeight,canvasWidth/COLOURS.length,(1-BAR_Y)*canvasHeight),a.stroke(),a.font="30px Arial",a.textAlign="center",a.textBaseline="middle",a.fillText(b[c],c*canvasWidth/COLOURS.length+canvasWidth/COLOURS.length/2,BAR_Y*canvasHeight+(1-BAR_Y)*canvasHeight/2),a.textBaseline="alphabetic"}function correction(){correct?(percent_pulse<PERCENT_MAX&&(percent_pulse+=PERCENT_INCREASE),percent_pulse>=PERCENT_MAX&&(percent_pulse=PERCENT_MAX),score++,score>bestScore&&(bestScore=score)):(borderAlpha=1,score=0,percent_pulse=100,removeAlpha())}function borderTick(){borderAlpha<=0||(borderAlpha-=1/30,borderAlpha<=0&&(borderAlpha=0))}function drawCorrect(a){a.fillStyle="#B22222",a.globalAlpha=borderAlpha,a.fillRect(0,0,canvasWidth,canvasHeight),a.globalAlpha=1}function init(){mainTimer=setInterval(tick,20);var a=document.getElementById("barCanvas");a.getContext("2d");initControlBar(),initBar()}function tick(){update(),render()}function update(){barTick(),colourBarTick(),borderTick(),particleTick(),percentTick()}function render(){var a=document.getElementById("barCanvas"),b=a.getContext("2d");b.save(),resizeCanvas(a,b),b.clearRect(0,0,canvasWidth,canvasHeight),drawControlBar(b),drawMainBar(b),drawBars(b),drawCorrect(b),drawParticles(b),drawScore(b),drawRules(b),b.restore()}function initBar(){pulseTimer=setTimeout(pulse,6e4/90)}function pulse(){pulseSize=.04,colourPulse(),createBars(),percentPulse(),pulseTimer=setTimeout(pulse,6e4/90)}function barTick(){pulseSize>0&&(pulseSize-=.01),pulseSize<0&&(pulseSize=0)}function drawMainBar(a){a.fillStyle="#000000",a.fillRect(0,(BAR_Y-.02-pulseSize/2)*canvasHeight,canvasWidth,(.04+pulseSize)*canvasHeight),a.fillRect(0,(BAR_Y/8-.02-pulseSize/2)*canvasHeight,canvasWidth,(.04+pulseSize)*canvasHeight)}function randomInt(a){return Math.floor(Math.random()*a)}function booleanArray(a,b){var c=b-a;if(!(c<0)){for(var d=[],e=0;e<c;e++)d.push(!1);for(var f=0;f<a;f++)d.splice(randomInt(b),0,!0);return d}}function sortNumber(a,b){return a-b}function groupSplice(a,b){if(!(a.length<b.length)&&0!==b.length){b.sort(sortNumber);for(var c=b.length-1;c>=0;c--)a.splice(b[c],1)}}function increaseIfPossible(a,b,c){return a>=c?a:(increased=a+b,increased>=c&&(increased=c),increased)}function decreaseIfPossible(a,b,c){return a<=c?a:(decreased=a-b,decreased<=c&&(decreased=c),decreased)}function spawnParticle(a,b,c){particles.push({x:a,y:b,angle:2*Math.random()*Math.PI,colour:c,alpha:1,travelSpeed:.02*(1/6)})}function particleTick(){for(var a=[],b=0;b<particles.length;b++)particles[b].alpha-=.02,particles[b].alpha<=0&&(particles[b].alpha=0,a.push(b));groupSplice(particles,a)}function moveParticle(a){a.x+=a.travelSpeed*Math.sin(a.angle)*canvasWidth,a.y+=a.travelSpeed*Math.cos(a.angle)*canvasHeight}function drawParticles(a){for(var b=.02*canvasHeight,c=0;c<particles.length;c++)moveParticle(particles[c]),a.save(),a.translate(particles[c].x+b/2,particles[c].y+b/2),a.rotate(particles[c].angle),a.fillStyle=particles[c].colour,a.globalAlpha=particles[c].alpha,a.fillRect(-b/2,-b/2,b,b),a.restore();a.restore(),a.globalAlpha=1}function resizeCanvas(a,b){fitToContainer(a,b)}function percentPulse(){percent=percent_pulse}function percentTick(){percent>100&&(percent-=(percent_pulse-100)/8,percent<=100&&(percent=100))}function fitToContainer(a,b){a.style.width="100%",a.style.height="100%",w=a.offsetWidth,h=a.offsetHeight,a.width=w,a.height=h,canvasWidth=w*percent/100,canvasHeight=h*percent/100,b.translate(-(percent-100)*w/200,-(percent-100)*h/200)}function drawRules(a){a.font="30px Arial",a.textAlign="right",a.fillText("Hold down the correct keys to get points",canvasWidth-10,50)}function drawScore(a){a.font="30px Arial",a.textAlign="left",a.fillText(score+"  Best: "+bestScore,10,50)}var colourBars=[],BAR_JUMP_FRAMES=5,COLOUR_PULSE_FRAMES=4,COLOUR_BAR_HEIGHT=.01,COLOUR_PULSE_CONSTANT=.04,colourPulseSize=0,BAR_POSITIONS=8,BAR_PARTICLES=30,colourIndices=[],correct=!0,CORRECT_BORDER_THICKNESS=.05,BORDER_FADE_FRAMES=30,BORDER_INIT_ALPHA=1,borderAlpha=0,mainTimer=!1,FPS=50,mainInterval=20,bpm=90,pulseInterval=6e4/90,COLOURS=["red","blue","yellow","green"],canvasWidth=0,canvasHeight=0,BAR_FADE_SCORE=10,BAR_FADE_END_SCORE=100,minimumFadeAge=69,BAR_FADE_MAXIMUM=200,BAR_FADE_MINIMUM=100,BAR_FADE_FRAMES=50,pulseSize=0,pulseTimer=!1,PULSE_FRAMES=4,PULSE_CONSTANT=.04,BAR_HEIGHT=.04,BAR_Y=.9,PARTICLE_EDGE_HEIGHT=.02,PARTICLE_LIFESPAN=50,PARTICLE_RELATIVE_SPEED=1/6,particles=[],percent=100,percent_pulse=100,PERCENT_FRAMES=8,PERCENT_MAX=150,PERCENT_INCREASE=1,score=0,bestScore=0;