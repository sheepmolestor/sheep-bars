/*! sheep-bars 08-03-2017 */
function createBars(){barAmount=randomInt(COLOURS.length-1)+1,colourBars.push({barJumpDisplacement:0,barPosition:1,barColour:Math.floor(Math.random()*COLOURS.length),barBooleans:booleanArray(barAmount,COLOURS.length),barCorrects:booleanArray(0,COLOURS.length)})}function colourPulse(){colourPulseSize=.04,barShift()}function colourBarTick(){colourPulseSize>0&&(colourPulseSize-=.01),colourPulseSize<0&&(colourPulseSize=0);for(var a=0;a<colourBars.length;a++)colourBars[a].barJumpDisplacement>0&&colourBars[a].barJumpDisplacement--}function barShift(){correct=!0;for(var a=[],b=0;b<colourBars.length;b++){if(colourBars[b].barCorrects=booleanArray(0,COLOURS.length),8==colourBars[b].barPosition){for(var c=0;c<COLOURS.length;c++)colourBars[b].barBooleans[c]!=colourIndices[c]?(correct=!1,colourBars[b].barCorrects[c]=!1):colourBars[b].barBooleans[c]&&colourIndices[c]&&(colourBars[b].barCorrects[c]=!0);a.push(b),correction()}colourBars[b].barJumpDisplacement=5,colourBars[b].barPosition++}for(var d=0;d<a.length;d++)for(var e=0;e<COLOURS.length;e++)if(colourBars[a[d]].barCorrects[e])for(var f=0;f<30;f++)spawnParticle((Math.random()+e)*canvasWidth/COLOURS.length,BAR_Y*canvasHeight,COLOURS[e]);groupSplice(colourBars,a)}function drawBars(a,b){for(var c=0;c<colourBars.length;c++)for(var d=0;d<colourBars[c].barBooleans.length;d++)b.fillStyle=COLOURS[d],colourBars[c].barBooleans[d]&&b.fillRect(d*(canvasWidth/COLOURS.length),((colourBars[c].barPosition-colourBars[c].barJumpDisplacement/5)*(BAR_Y/8)-.005-colourPulseSize/2)*canvasHeight,canvasWidth/COLOURS.length,(.01+colourPulseSize)*canvasHeight)}function initControlBar(){for(var a=0;a<COLOURS.length;a++)colourIndices.push(!1);document.onkeydown=function(a){e=a.keyCode,83==e?colourIndices[0]=!0:68==e?colourIndices[1]=!0:74==e?colourIndices[2]=!0:75==e&&(colourIndices[3]=!0)},document.onkeyup=function(a){e=a.keyCode,83==e?colourIndices[0]=!1:68==e?colourIndices[1]=!1:74==e?colourIndices[2]=!1:75==e&&(colourIndices[3]=!1)}}function drawControlBar(a,b){for(var c=0;c<colourIndices.length;c++)b.fillStyle=COLOURS[c],colourIndices[c]&&b.fillRect(c*canvasWidth/COLOURS.length,BAR_Y*canvasHeight,canvasWidth/COLOURS.length,(1-BAR_Y)*canvasHeight)}function correction(){correct||(borderAlpha=1)}function borderTick(){borderAlpha<=0||(borderAlpha-=1/30,borderAlpha<=0&&(borderAlpha=0))}function drawCorrect(a,b){b.fillStyle="#B22222",b.globalAlpha=borderAlpha,b.fillRect(0,0,canvasWidth,canvasHeight),b.globalAlpha=1}function init(){mainTimer=setInterval(tick,20);var a=document.getElementById("barCanvas");a.getContext("2d");initControlBar(),initBar()}function tick(){update(),render()}function update(){barTick(),colourBarTick(),borderTick(),particleTick(),percentTick()}function render(){var a=document.getElementById("barCanvas"),b=a.getContext("2d");b.save(),resizeCanvas(a,b),b.clearRect(0,0,canvasWidth,canvasHeight),drawControlBar(a,b),drawMainBar(a,b),drawBars(a,b),drawCorrect(a,b),drawParticles(a,b),b.restore()}function initBar(){pulseTimer=setTimeout(pulse,6e4/90)}function pulse(){pulseSize=.04,colourPulse(),createBars(),percentPulse(),pulseTimer=setTimeout(pulse,6e4/90)}function barTick(){pulseSize>0&&(pulseSize-=.01),pulseSize<0&&(pulseSize=0)}function drawMainBar(a,b){b.fillStyle="#000000",b.fillRect(0,(BAR_Y-.02-pulseSize/2)*canvasHeight,canvasWidth,(.04+pulseSize)*canvasHeight),b.fillRect(0,(BAR_Y/8-.02-pulseSize/2)*canvasHeight,canvasWidth,(.04+pulseSize)*canvasHeight)}function randomInt(a){return Math.floor(Math.random()*a)}function booleanArray(a,b){var c=b-a;if(!(c<0)){for(var d=[],e=0;e<c;e++)d.push(!1);for(var f=0;f<a;f++)d.splice(randomInt(b),0,!0);return d}}function sortNumber(a,b){return a-b}function groupSplice(a,b){if(!(a.length>b.length)&&0!==b.length){b.sort(sortNumber);for(var c=b.length-1;c>=0;c--)a.splice(b[c],1)}}function spawnParticle(a,b,c){particles.push({x:a,y:b,angle:2*Math.random()*Math.PI,colour:c,alpha:1,travelSpeed:.02*(1/6)})}function particleTick(){for(var a=[],b=0;b<particles.length;b++)particles[b].alpha-=.05,particles[b].alpha<=0&&(particles[b].alpha=0,a.push(b));groupSplice(particles,a)}function moveParticle(a,b){a.x+=a.travelSpeed*Math.sin(a.angle)*canvasWidth,a.y+=a.travelSpeed*Math.cos(a.angle)*canvasHeight}function drawParticles(a,b){for(var c=.02*canvasHeight,d=0;d<particles.length;d++)moveParticle(particles[d],a),b.save(),b.translate(particles[d].x+c/2,particles[d].y+c/2),b.rotate(particles[d].angle),b.fillStyle=particles[d].colour,b.globalAlpha=particles[d].alpha,b.fillRect(-c/2,-c/2,c,c),b.restore();b.restore(),b.globalAlpha=1}function resizeCanvas(a,b){fitToContainer(a,b)}function percentPulse(){percent=120}function percentTick(){percent>100&&(percent-=2.5,percent<=100&&(percent=100))}function fitToContainer(a,b){a.style.width="100%",a.style.height="100%",w=a.offsetWidth,h=a.offsetHeight,a.width=w,a.height=h,canvasWidth=w*percent/100,canvasHeight=h*percent/100,b.translate(-(percent-100)*w/200,-(percent-100)*h/200)}var colourBars=[],BAR_JUMP_FRAMES=5,COLOUR_PULSE_FRAMES=4,COLOUR_BAR_HEIGHT=.01,COLOUR_PULSE_CONSTANT=.04,colourPulseSize=0,BAR_POSITIONS=8,BAR_PARTICLES=30,colourIndices=[],correct=!0,CORRECT_BORDER_THICKNESS=.05,BORDER_FADE_FRAMES=30,BORDER_INIT_ALPHA=1,borderAlpha=0,mainTimer=!1,FPS=50,mainInterval=20,bpm=90,pulseInterval=6e4/90,COLOURS=["red","blue","yellow","green"],canvasWidth=0,canvasHeight=0,pulseSize=0,pulseTimer=!1,PULSE_FRAMES=4,PULSE_CONSTANT=.04,BAR_HEIGHT=.04,BAR_Y=.9,PARTICLE_EDGE_HEIGHT=.02,PARTICLE_LIFESPAN=20,PARTICLE_RELATIVE_SPEED=1/6,particles=[],percent=100,PERCENT_PULSE=120,PERCENT_FRAMES=8;